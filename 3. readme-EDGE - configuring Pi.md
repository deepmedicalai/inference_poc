

# Copy necessary files to PI

## Create directory on raspberry device

```
export INSTALL_DIR="/root/bin"
ssh pi@192.168.1.201 "sudo mkdir $INSTALL_DIR"

```


## Copy files to Raspberry PI device

### Copy runtime files to PI device

Enter your IP address of Raspberry PI address. 

```
tar -c -C ./setup-pi/archive-root . | ssh pi@192.168.1.201 "sudo tar -x --no-same-owner -C $INSTALL_DIR"
```

You can verify that scripts where copied by SSH to Raspberry device and checking files
```
ssh pi@172.20.10.7
sudo -i
cd /root/bin
ls
head ./archiveloop
```

### Copy setup script to PI device

Enter your IP address of Raspberry PI address. 

```
export ROOT_DIR="/root"
tar -c -C ./setup-pi/setup-file .| ssh pi@192.168.1.201 "sudo tar -x --no-same-owner -C $ROOT_DIR"
```

## Become root on the Pi
First you need to get into a root shell on the Pi:
```
sudo -i
```
You'll stay in this root shell until you run the `halt` command below.

## Configure Share on your host (for testing)

```
ping -c 3 dmitrys-mbp
```

if you cannot ping by dns, then use IP address `ping -c 3 172.20.10.4' where IP is ip of you archive system (Main Device)

```
export archiveserver="192.168.1.203"
export sharename="share"
export shareuser="usbfish"
export sharepassword="Pass1234+"
```

for main server connectivity
```
export MAIN_SERVER_URL="http://192.168.1.203:5000"
export MAIN_SERVER_APIKEY="edge0001-key"
```

you can test health API of Main Server
```
curl -X GET "$MAIN_SERVER_URL/health/"
```


## Configure hostname
```
export DMAI_EDGE_HOSTNAME="dmai-edge-0001"
```

Make sure that whatever you speicfy for the new hostname is compliant with the rules for DNS hostnames; for example underscore (_) is not allowed, but dash (-) is allowed. Full rules are in RFC 1178 at https://tools.ietf.org/html/rfc1178

## Execute setup script
```
chmod +x setup-pi.sh
./setup-pi.sh
```

and now if there were no errors, it is time to restart
```
halt
```

Disconnect the Pi from the computer.

On the next boot, the Pi hostname will become `dmai-edge-0001`, so future ssh sessions will be `ssh pi@dmai-edge-0001.local`. If you specified your own hostname, be sure to use that name (for example `ssh pi@yourhostname.local`)

Your Pi is now ready to be plugged into your Modality. 

## Make it root writeable

```
ssh pi@dmai-edge-0001.
sudo -i
/root/bin/remountfs_rw
```

